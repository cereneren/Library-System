<!-- Filter bar -->
<div class="filter-bar m-4" *ngIf="!loading && loans.length">
  <div class="form-check form-check-inline form-check-xl mx-3">
    <input id="fReturned" class="form-check-input" type="checkbox" [(ngModel)]="filters.returned">
    <label class="form-check-label" for="fReturned">Returned</label>
  </div>

  <div class="form-check form-check-inline form-check-xl mx-3">
    <input id="fOnLoan" class="form-check-input" type="checkbox" [(ngModel)]="filters.onLoan">
    <label class="form-check-label" for="fOnLoan">On loan</label>
  </div>

  <div class="form-check form-check-inline form-check-xl mx-3">
    <input id="fOverdue" class="form-check-input" type="checkbox" [(ngModel)]="filters.overdue">
    <label class="form-check-label" for="fOverdue">Overdue</label>
  </div>

  <!-- All -->
  <div class="form-check form-check-inline mx-3">
    <input class="form-check-input" type="checkbox"
           [checked]="allChecked"
           [indeterminate]="isCustom"
           (change)="setAllFilters(true)">
    <label class="form-check-label">All</label>
  </div>

  <!-- None -->
  <div class="form-check form-check-inline mx-3">
    <input class="form-check-input" type="checkbox"
           [checked]="noneChecked"
           [indeterminate]="isCustom"
           (change)="setAllFilters(false)">
    <label class="form-check-label">None</label>
  </div>

</div>


<!-- No results messages -->
<div *ngIf="!loading && loans.length === 0" class="text-muted">No loans found.</div>
<div *ngIf="!loading && loans.length > 0 && filteredLoans.length === 0" class="text-muted">
  No loans match the selected filters.
</div>

<!-- Table -->
<div *ngIf="!loading && filteredLoans.length" class="table-responsive mt-4 mb-4 m-4">
  <table class="table table-sm align-middle">
    <thead>
    <tr>
      <th>Title</th>
      <th *ngIf="isLibrarian">Member</th>
      <th>Loaned</th>
      <th>Due</th>
      <th>Status</th>
      <th class="text-end" *ngIf="isLibrarian"></th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let l of filteredLoans">
      <td class="fw-semibold">{{ l.book.title }}</td>
      <td *ngIf="isLibrarian">{{ l.member?.fullName || '—' }}</td>
      <td>{{ l.loanDate | date:'mediumDate' }}</td>
      <td>{{ l.dueDate   | date:'mediumDate' }}</td>
      <td>
          <span *ngIf="l.returnDate" class="badge bg-success">
            Returned {{ l.returnDate | date:'mediumDate' }}
          </span>
        <span *ngIf="!l.returnDate && isOverdue(l)" class="badge bg-danger">Overdue</span>
        <span *ngIf="!l.returnDate && !isOverdue(l)" class="badge bg-warning text-dark">On loan</span>
      </td>
      <td class="text-end" *ngIf="isLibrarian">
        <button class="btn btn-outline-primary btn-sm"
                *ngIf="!l.returnDate"
                (click)="onReturn(l)"
                [disabled]="returning[l.id]">
          {{ returning[l.id] ? 'Returning…' : 'Return' }}
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>
